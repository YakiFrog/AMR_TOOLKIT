# Map and Waypoint Editor - システム概要

## 1. システムの目的

本システムは、自律移動ロボット用の経路設定を支援するマップエディタとして開発されました。以下の主要機能を提供します：

- PGM形式の地図画像の編集
- メートル座標系でのウェイポイント設定
- ロボット動作用の付加情報の管理
- 編集内容のYAML形式でのエクスポート

## 2. 主要機能

### 2.1 地図編集機能
- PGM形式の地図ファイルの読み込み/保存
- ペンツールによる描画
- 消しゴムツールによる編集
- グリッド表示によるスケール把握
- 5階層のレイヤー管理システム

### 2.2 ウェイポイント管理
- クリック＆ドラッグによる直感的な配置
- 方向指定による進行方向の設定
- ドラッグ＆ドロップによる順序変更
- カスタム属性の追加機能
- パス表示機能

### 2.3 座標系管理
- ピクセル座標とメートル座標の相互変換
- 原点設定による座標系の調整
- リアルタイムの座標表示
- 解像度に基づく正確な距離計算

### 2.4 フォーマット管理
- カスタマイズ可能なYAMLフォーマット
- バージョン管理機能
- インポート/エクスポート機能
- フォーマットの検証機能

## 3. システム構成

### 3.1 UI構成
- メインウィンドウ（左：編集領域、右：コントロールパネル）
- レイヤー管理パネル
- ウェイポイントリスト
- フォーマットエディタ
- ツールバー（描画ツール、ズーム制御）

### 3.2 データ構造
```yaml
# ウェイポイントデータ構造例
waypoints:
  - number: 1
    x: 10.5          # メートル座標
    y: 20.3
    angle_degrees: 45.0
    actions:         # カスタム属性
      - type: "move_forward"
        distance: 1.0
```

### 3.3 保存形式
1. PGMファイル：地図画像データ
2. YAMLファイル：
   - 地図メタデータ（解像度、原点情報）
   - ウェイポイントデータ
   - フォーマット定義

## 4. 技術仕様

### 4.1 使用技術
- GUI: PySide6 (Qt)
- 画像処理: NumPy
- データ形式: YAML, PGM
- 座標変換: カスタム実装

### 4.2 動作要件
- Python 3.7以上
- 必要メモリ: 4GB以上推奨
- ディスプレイ解像度: 1280x720以上推奨

## 5. 操作フロー

1. 地図ファイルの読み込み
   - PGMファイル選択
   - YAMLファイルによる設定読み込み

2. 編集作業
   - 地図の修正（ペン/消しゴム）
   - ウェイポイントの配置
   - 属性の設定

3. データの出力
   - 編集済み地図の保存
   - ウェイポイント情報のエクスポート
